---
title: "hagis"
author: "Austin McCoy and Zachary Noel"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```
## Installation of hagis and other packages

Currently you can only install hagis from github. The following code will install the package:
```{r, message=FALSE}
if (!require("remotes")) {
  install.packages("remotes", repos = "http://cran.rstudio.com/")
  library("remotes")
}

install_github("openplantpathology/hagis", build_vignettes = TRUE)
```

the ipak function will install and load in all necessary packages to produce the following graphics. "TRUE" in the output indicates that the packages were loaded correctly. These packages are not necessary for 'hagis' to work, but make it easy to produce eye pleasing graphics.
```{r, echo=TRUE, message=FALSE}
# Source: https://gist.github.com/stevenworthington/3178163
ipak <- function(pkg){
new.pkg <- pkg[!(pkg %in% installed.packages()[,"Package"])]
if (length(new.pkg)) 
    install.packages(new.pkg, dependencies = TRUE)
sapply(pkg, require, character.only = TRUE)
}
packages <- c("ggplot2", "ggsci", "purrr", "hagis")
ipak(packages)
```

***
## Getting Started
First you'll want to load in your data set, for right now lets use a practice data set made for the hagis package and name it "Pathotype.Data":
```{r}
Pathotype.Data <- system.file("extdata", "practice_data_set.csv", package = "hagis")
Pathotype.Data <- read.csv(Pathotype.Data)
head(Pathotype.Data)
```
This practice data set contains 21 isolates' virulence data on a set of 14 differential soybean cultivars. This package uses the percentage of susceptible, inoculated, plants  to determine effective resistance genes, pathotype diversity and frequency, as well as individual isolates pathotypes.

***

## Important terms used in this packages' functions

"x = " followed by your data set name allows for the function to identify where it will be pulling these columns (and their associated row values) from to use (i.e. your data collection excel sheet)

"sample = " refers to the column header for the column which identifies the isolates tested

"perc.susc = " refers to the column header for the column which identifies the percent susceptible plants for each gene

"Rps = " refers to the column header for the column which identifies the genes tested


The cutoff value sets the cutoff for susceptible reactions. For example, 'cutoff = 60' means that all genes with 60% or more of the plants rated susceptible will be treated as susceptible. You can change this to whatever percentage you require for your study.

***

## Determination of effective resistance genes

Below is an example of tables and graphics that can be produced using the [summarize_rps()](https://openplantpathology.github.io/hagis/reference/summarize_rps.html "summarize_rps()") function to identify effective resistance genes tested against the sampled *Phytophthora sojae* population. 

The summarize_rps function allows you to produce a detailed table showing the number of isolates each gene is susceptible to (N_susc), as well as offering a percentage of the isolates tested which are pathogenic on each gene (percent_pathogenic).
```{r, echo=TRUE}
Rps.summary <- summarize_rps(x = Pathotype.Data,
              cutoff = 60,
              control = "susceptible",
              sample = "Isolate",
              Rps = "Rps",
              perc_susc = "perc.susc")

pander::pander(Rps.summary)
```

You can put this data into 'ggplot2' so that you can change the graph design to your liking.
```{r, echo=TRUE}
ggplot(data = Rps.summary,aes(x = Rps ,y = N_susc)) +
  scale_fill_npg() +
    stat_summary(fun.y=mean,position=position_dodge(width=0.95), geom="bar") +
  #stat_summary(fun.data = mean_se,position=position_dodge(width=0.95), geom = "errorbar") +
  theme_gray() +
    guides(fill = FALSE) +
    theme(axis.text.x = element_text(size = 15, face = "bold", angle=45, hjust=1, family = "serif"),
        axis.text.y = element_text(size = 20, face = "bold", family = "serif"),
        axis.title.x = element_text(size = 20, face = "bold", family = "serif"),
        axis.title.y = element_text(size = 15, face = "bold", family = "serif"),
        axis.line.x = element_line(colour = 'gray', size=0.5, linetype='solid'),
        axis.line.y = element_line(colour = 'gray', size=0.5, linetype='solid'),
        legend.text = element_text(size = 10, face = "bold", family = "serif"),
        legend.key = element_blank(),
        legend.title = element_text(size = 10, face="bold", family = "serif"),
        legend.position = "right",
        strip.text.x = element_text(size = 25, face = "bold", family = "serif"),
        title = element_text(size = 16, family = "serif")) +
  xlab("Rps gene") + ylab("Number of isolates pathogenic")

ggplot(data = Rps.summary,aes(x = Rps ,y = percent_pathogenic)) +
  scale_fill_npg() +
    stat_summary(fun.y=mean,position=position_dodge(width=0.95), geom="bar") +
  #stat_summary(fun.data = mean_se,position=position_dodge(width=0.95), geom = "errorbar") +
  theme_gray() +
    guides(fill = FALSE) +
    theme(axis.text.x = element_text(size = 15, face = "bold", angle=45, hjust=1, family = "serif"),
        axis.text.y = element_text(size = 20, face = "bold", family = "serif"),
        axis.title.x = element_text(size = 20, face = "bold", family = "serif"),
        axis.title.y = element_text(size = 15, face = "bold", family = "serif"),
        axis.line.x = element_line(colour = 'gray', size=0.5, linetype='solid'),
        axis.line.y = element_line(colour = 'gray', size=0.5, linetype='solid'),
        legend.text = element_text(size = 10, face = "bold", family = "serif"),
        legend.key = element_blank(),
        legend.title = element_text(size = 10, face="bold", family = "serif"),
        legend.position = "right",
        strip.text.x = element_text(size = 25, face = "bold", family = "serif"),
        title = element_text(size = 16, family = "serif")) +
  xlab("Rps gene") + ylab("Percentage of isolates pathogenic")
```

***

##Pathotype Complexities

Pathotype frequency, distribution as well as statistics such as mean pathotype complexity can be caluculated using the calculate_complexities() function. Below are examples of producible graphics using [calculate_complexities()](https://openplantpathology.github.io/hagis/reference/calculate_complexities.html "calculate_complexities()"). 

pander::pander (from the 'purrr' package) takes your data and makes an attractive table with it.
```{r, echo=TRUE, message=FALSE, warning=FALSE}
complexities <- calculate_complexities(x = Pathotype.Data, 
                                       cutoff = 60, 
                                       control = "susceptible", 
                                       sample = "Isolate", 
                                       Rps = "Rps", 
                                       perc_susc = "perc.susc")


pander::pander(complexities$grouped_complexities)

pander::pander(complexities$indvidual_complexities)
```

The mean, standard error (se) and standard deviation (sd) for pathotypes 
```{r}
pander::pander(summary(complexities))
```

***

##Diversity Indices, frequency of Unique Pathotypes and Individual Isolate Pathotypes
Diversity indicies are extremely useful when trying to identify differences between two populations. Here, pathotype diversities are calculated for the sample population using the  [calculate_diversities()](https://openplantpathology.github.io/hagis/reference/calculate_diversities.html "calculate_diversities()") function. Likewise, Individual Isolates pathotypes, number of isolates used in the study, number of pathotypes within the study are calculated. 

```{r, echo=TRUE}
diversity <- calculate_diversities(x = Pathotype.Data,
                                   cutoff = 60,
                                   control = "susceptible",
                                   sample = "Isolate",
                                   Rps = "Rps",
                                   perc_susc = "perc.susc")
pander::pander(diversity)
```

***
